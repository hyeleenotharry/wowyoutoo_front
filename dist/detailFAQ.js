(()=>{"use strict";const e="http://127.0.0.1:8000",t="http://127.0.0.1:5500",n=new URLSearchParams(window.location.search).get("qna_id");function o(){window.location.href=`${t}/templates/ModifyFAQ.html?qna_id=${n}`}async function a(n){try{const o=localStorage.getItem("access");let a;console.log("토큰:",o),null==o?(console.log("없다?"),a=await fetch(`${e}/service/qna/${n}/response/`,{headers:{"Content-Type":"application/json"},method:"GET"})):a=await fetch(`${e}/service/qna/${n}/response/`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},method:"GET"}),200!=a.status&&(location.href=`${t}/templates/FAQList.html`),a.ok?document.getElementById("deleteAnswerButton").style.display="block":document.getElementById("deleteAnswerButton").style.display="none";const c=await a.json();if(null==c.content?(document.getElementById("deleteAnswerButton").style.display="none",document.getElementById("faqAns").textContent="답변이 아직 없습니다."):(document.getElementById("faqAns").textContent=c.content,document.get),null!=c.image){const t=`${e}${c.image}`,n=document.createElement("img");n.src=t,document.getElementById("answerImage").appendChild(n)}}catch(e){console.error("Error fetching FAQ Answer:",e),location.href=`${t}/templates/FAQList.html`}}async function c(){if(confirm("정말로 삭제하시겠습니까?"))try{const o=localStorage.getItem("access");await fetch(`${e}/service/qna/${n}/response/`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),alert("FAQ 답변이 삭제되었습니다."),location.href=`${t}/templates/DetailFAQ.html?qna_id=${n}`}catch(e){console.error("Error deleting FAQ:",e),location.href=`${t}/templates/FAQList.html`}}async function l(){if(confirm("정말로 삭제하시겠습니까?"))try{const o=localStorage.getItem("access"),a=await fetch(`${e}/service/qna/${n}/`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}});if(!a.ok)throw new Error(`Server returned an error ${a.status}: ${a.statusText}`);alert("FAQ가 삭제되었습니다."),location.href=`${t}/templates/FAQList.html`}catch(e){console.error("Error deleting FAQ:",e)}}function s(){var e=document.getElementById("image_input"),t=document.getElementById("file_name");if(e.files.length>0){var n=e.files[0].name;t.textContent="Selected File: "+n}else t.textContent=""}window.onload=async function(){$("#image_input").on("change",s),$("#editButton").on("click",o),$("#deleteAnswerButton").on("click",c),$("#deleteButton").on("click",l),async function(n){try{const o=localStorage.getItem("access");let a;null==o?(console.log("없다?"),a=await fetch(`${e}/service/qna/${n}/`,{headers:{"Content-Type":"application/json"},method:"GET"})):a=await fetch(`${e}/service/qna/${n}/`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},method:"GET"}),200!=a.status&&(location.href=`${t}/templates/FAQList.html`);const c=await a.json();if(document.getElementById("faqCategory").textContent=c.question_type,document.getElementById("faqTitle").textContent=c.title,document.getElementById("faqAuthor").textContent=c.username,document.getElementById("faqDate").textContent=c.created_at,document.getElementById("faqContent").textContent=c.content,null!=c.image){const t=`${e}${c.image}`,n=document.createElement("img");n.src=t,document.getElementById("faqImage").appendChild(n),document.getElementById("lockContainer")}if(c.is_private){const e=!0;lockContainer.style.display=e?"none":"block"}else lockContainer.style.display="none"}catch(e){console.log(e)}}(n);try{a(n)}catch(e){console.log(e)}document.getElementById("answerSubmitBtn").addEventListener("click",(function(){!async function(t){const n=new FormData;var o=document.getElementById("answerContentInput"),c=document.getElementById("image_input"),l=document.getElementById("file_name");if(n.append("content",o.value),!o.value)return alert("내용을 입력해라!"),void console.log(o.value);c.files.length>0?n.append("image",c.files[0]):console.log(n);try{const a=localStorage.getItem("access"),s=await fetch(`${e}/service/qna/${t}/response/`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:n});if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const r=await s.json();console.log("Success:",r),alert("작성되었습니다"),o.value="",c.value="",l.textContent=""}catch(e){console.error("Error:",e)}a(t)}(n)}))}})();