(()=>{"use strict";const e=document.createElement("link");e.rel="stylesheet",e.href="../css/myPage.css",document.head.appendChild(e);const t="http://127.0.0.1:8000";function n(e){"프로필 수정"==e.target.text?function(e){const t=document.getElementById("nickname"),n=document.getElementById("email"),o=document.getElementById("profile-img");t.style.display="none",n.style.display="none",o.style.display="none";const l=document.getElementById("new-nick"),d=document.getElementById("ex-pwd"),a=document.getElementById("new-pwd1"),i=document.getElementById("new-pwd2"),c=document.getElementById("new-img");var m,s,r;l.style.display="block",d.style.display="block",a.style.display="block",i.style.display="block",c.style.display="block",document.getElementById("modify").innerText="수정 완료",m=document.getElementById("profile-box"),s=document.getElementById("menu-box"),r=m.offsetHeight,console.log(r),m.style.marginTop="-450px",s.style.marginTop="600px"}():async function(){const e=localStorage.getItem("access"),n=JSON.parse(localStorage.getItem("payload")).user_id,o=document.getElementById("nick-val").value,l=document.getElementById("ex-pwd-val").value,d=document.getElementById("new-pwd-val1").value,a=document.getElementById("new-pwd-val2").value;let i=new FormData;try{document.getElementById("new-profile-img").files[0]&&(i.append("profile_img",document.getElementById("new-profile-img").files[0]),console.log(document.getElementById("new-profile-img").files[0]))}catch(e){console.log(e.response)}if(null==l&&alert("기존 비밀번호는 필수로 입력해주세요"),d.val!=a.val)alert("입력한 비밀번호와 비밀번호 확인이 다릅니다.");else{i.append("nickname",o),i.append("present_pw",l),i.append("password",d),i.append("password_check",a);try{await fetch(`${t}/accounts/profile/${n}/`,{headers:{Authorization:`Bearer ${e}`},method:"PUT",body:i}).then((e=>{200==e.status&&(alert("프로필 수정이 완료되었습니다."),window.location.reload())}))}catch(e){console.log(e.response.data.message)}}}()}function o(){window.location.href="../templates/myWord.html"}function l(){window.location.href="../templates/SavedReading.html"}$(document).ready((function(){$("#modify").on("click",n),$("#my-word").on("click",o),$("#my-reading").on("click",l);const e=document.getElementById("new-nick"),d=document.getElementById("ex-pwd"),a=document.getElementById("new-pwd1"),i=document.getElementById("new-pwd2"),c=document.getElementById("new-img");e.style.display="none",d.style.display="none",a.style.display="none",i.style.display="none",c.style.display="none";try{localStorage.getItem("provider")&&(document.getElementById("modify").style.display="none")}catch(e){console.log(e)}!async function(){const e=JSON.parse(localStorage.getItem("payload")).user_id,n=localStorage.getItem("access");try{await fetch(`${t}/accounts/profile/${e}/`,{headers:{Authorization:`Bearer ${n}`},method:"GET"}).then((e=>{if(200==e.status)return e.json()})).then((e=>{const n=document.getElementById("nickname"),o=document.getElementById("email"),l=(document.getElementById("profile-img"),document.getElementById("my-coin"));if("undefined"==e.profile_img)$("#profile-img").attr("src","https://media.licdn.com/dms/image/C5103AQE6wN_SiFGQrQ/profile-displayphoto-shrink_200_200/0/1517547117016?e=1701907200&v=beta&t=OIxWdliiKCDdNi-fyFFCUthcuYUcmSo6jQWTYX5uEt4");else{var d=t+e.profile_img,a=decodeURIComponent(d),i=a.indexOf("media/")+6,c=a.substring(i);console.log(c),n.innerText=e.nickname,o.innerText=e.email,l.innerText=e.coin;try{if("github"==localStorage.getItem("provider"))$("#profile-img").attr("src",c);else if("kakao"==localStorage.getItem("provider")){var m=c.replace("http:/","https://");$("#profile-img").attr("src",m)}else $("#profile-img").attr("src",d)}catch(e){console.log(e),alert(e)}}const s=document.getElementById("word-quiz"),r=document.getElementById("reading-quiz"),y=document.getElementById("rank");s.innerText=e.word_nums,r.innerText=e.reading_nums,y.innerText=`${e.my_rank} 위`,$("#nick-val").val(e.nickname)}))}catch(e){alert(e),window.location.href="../templates/main.html"}}()}))})();