(()=>{"use strict";const e="http://127.0.0.1:8000";function t(t){"프로필 수정"==t.target.text?function(e){const t=document.getElementById("nickname"),n=document.getElementById("email"),o=document.getElementById("profile-img");t.style.display="none",n.style.display="none",o.style.display="none";const l=document.getElementById("new-nick"),d=document.getElementById("ex-pwd"),a=document.getElementById("new-pwd1"),i=document.getElementById("new-pwd2"),m=document.getElementById("new-img");var c,s,r;l.style.display="block",d.style.display="block",a.style.display="block",i.style.display="block",m.style.display="block",document.getElementById("modify").innerText="수정 완료",c=document.getElementById("profile-box"),s=document.getElementById("menu-box"),r=c.offsetHeight,console.log(r),c.style.marginTop="-450px",s.style.marginTop="600px"}():async function(){const t=localStorage.getItem("access"),n=JSON.parse(localStorage.getItem("payload")).user_id,o=document.getElementById("nick-val").value,l=document.getElementById("ex-pwd-val").value,d=document.getElementById("new-pwd-val1").value,a=document.getElementById("new-pwd-val2").value;let i=new FormData;try{document.getElementById("new-profile-img").files[0]&&(i.append("profile_img",document.getElementById("new-profile-img").files[0]),console.log(document.getElementById("new-profile-img").files[0]))}catch(e){console.log(e.response)}if(null==l&&alert("기존 비밀번호는 필수로 입력해주세요"),d.val!=a.val)alert("입력한 비밀번호와 비밀번호 확인이 다릅니다.");else{i.append("nickname",o),i.append("present_pw",l),i.append("password",d),i.append("password_check",a);try{await fetch(`${e}/accounts/profile/${n}/`,{headers:{Authorization:`Bearer ${t}`},method:"PUT",body:i}).then((e=>{200==e.status&&(alert("프로필 수정이 완료되었습니다."),window.location.reload())}))}catch(e){console.log(e.response.data.message)}}}()}function n(){window.location.href="../templates/myWord.html"}function o(){window.location.href="../templates/SavedReading.html"}$(document).ready((function(){$("#modify").on("click",t),$("#my-word").on("click",n),$("#my-reading").on("click",o);const l=document.getElementById("new-nick"),d=document.getElementById("ex-pwd"),a=document.getElementById("new-pwd1"),i=document.getElementById("new-pwd2"),m=document.getElementById("new-img");l.style.display="none",d.style.display="none",a.style.display="none",i.style.display="none",m.style.display="none";try{localStorage.getItem("provider")&&(document.getElementById("modify").style.display="none")}catch(e){console.log(e)}!async function(){const t=JSON.parse(localStorage.getItem("payload")).user_id,n=localStorage.getItem("access");try{await fetch(`${e}/accounts/profile/${t}/`,{headers:{Authorization:`Bearer ${n}`},method:"GET"}).then((e=>{if(200==e.status)return e.json()})).then((t=>{const n=document.getElementById("nickname"),o=document.getElementById("email");if(document.getElementById("profile-img"),"undefined"==t.profile_img)$("#profile-img").attr("src","https://media.licdn.com/dms/image/C5103AQE6wN_SiFGQrQ/profile-displayphoto-shrink_200_200/0/1517547117016?e=1701907200&v=beta&t=OIxWdliiKCDdNi-fyFFCUthcuYUcmSo6jQWTYX5uEt4");else{var l=e+t.profile_img,d=decodeURIComponent(l),a=d.indexOf("media/")+6,i=d.substring(a);console.log(i),n.innerText=t.nickname,o.innerText=t.email;try{if("github"==localStorage.getItem("provider"))$("#profile-img").attr("src",i);else if("kakao"==localStorage.getItem("provider")){var m=i.replace("http:/","https://");$("#profile-img").attr("src",m)}else $("#profile-img").attr("src",l)}catch(e){console.log(e),alert(e)}}const c=document.getElementById("word-quiz"),s=document.getElementById("reading-quiz"),r=document.getElementById("rank");c.innerText=t.word_nums,s.innerText=t.reading_nums,r.innerText=`${t.my_rank} 위`,$("#nick-val").val(t.nickname)}))}catch(e){alert(e),window.location.href="../templates/main.html"}}()}))})();